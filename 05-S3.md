# 5. üì¶ S3 (Simple Storage Service)

**Object storage for the internet**

![S3 Access Management](https://media.amazonwebservices.com/blog/2017/s3e_access_sort_1.png)

![S3 Website Configuration](https://s3browser.com/images/bucket-website/website-configuration-dialog.png)

![S3 Lifecycle Transitions](https://cms.cloudoptimo.com/uploads/S3_Lifecycle_Transitions_dfffc45147.png)

![S3 Storage Classes](https://media.licdn.com/dms/image/v2/C5612AQHN_2ZHxQMKjw/article-cover_image-shrink_600_2000/article-cover_image-shrink_600_2000/0/1638030721883?e=2147483647\&t=mnFtNw0gV8qh2EIqC3RLdn8Cwt1pOTYR_6CpSUpXOlU\&v=beta)

## What is S3?

Amazon Simple Storage Service is object storage with 99.999999999% (11 nines) durability. Store and retrieve any amount of data from anywhere.

### Key Features
- ‚úÖ Unlimited storage
- ‚úÖ 99.99% availability
- ‚úÖ Object size: 0 bytes to 5 TB
- ‚úÖ Web-enabled (HTTP/HTTPS)
- ‚úÖ Server-side encryption
- ‚úÖ Versioning support

### Use Cases
- Backup and restore
- Data archiving
- Static website hosting
- Data lakes for analytics
- Content distribution
- Application hosting

## S3 Concepts

### Buckets
- **Container** for objects
- **Globally unique name** (across all AWS)
- **Regional** resource
- Naming: lowercase, 3-63 chars, no uppercase, no underscore

### Objects
- **Files** stored in buckets
- Consists of:
  - **Key**: Object name (path)
  - **Value**: Data itself
  - **Version ID**: If versioning enabled
  - **Metadata**: Key-value pairs
  - **Subresources**: ACL, torrent

### Example Structure
```
Bucket: my-website-bucket
Objects:
  - images/logo.png
  - css/style.css
  - index.html
  - about/team.html
```

## S3 Storage Classes

Choose based on access frequency and cost:

| Class | Use Case | Availability | Min Duration | Retrieval Fee |
|-------|----------|--------------|--------------|---------------|
| **S3 Standard** | Frequently accessed | 99.99% | None | No |
| **S3 Intelligent-Tiering** | Unknown patterns | 99.9% | None | No |
| **S3 Standard-IA** | Infrequent access | 99.9% | 30 days | Yes |
| **S3 One Zone-IA** | Recreatable data | 99.5% | 30 days | Yes |
| **S3 Glacier Instant** | Archive, instant | 99.9% | 90 days | Yes |
| **S3 Glacier Flexible** | Archive, min-hours | 99.99% | 90 days | Yes |
| **S3 Glacier Deep Archive** | Long-term archive | 99.99% | 180 days | Yes |

### Cost Comparison (approx per GB/month)
- Standard: $0.023
- Intelligent-Tiering: $0.023-$0.0125
- Standard-IA: $0.0125
- Glacier Instant: $0.004
- Glacier Flexible: $0.0036
- Glacier Deep Archive: $0.00099

## S3 Versioning

Keep multiple versions of an object in the same bucket.

### Benefits
- ‚úÖ Protect against accidental deletion
- ‚úÖ Easy rollback
- ‚úÖ Archive old versions

### How It Works
- Once enabled, cannot be disabled (only suspended)
- Each version gets unique version ID
- Delete adds delete marker (soft delete)
- Can permanently delete specific version

```
# Version history
index.html (version: abc123) - Latest
index.html (version: def456)
index.html (version: ghi789) - Oldest
```

## S3 Lifecycle Rules

Automate transitioning objects between storage classes.

### Example Policy
```
Rule: Archive old logs
- Transition to Standard-IA after 30 days
- Transition to Glacier after 90 days
- Delete after 365 days
```

### Configuration
```json
{
  "Rules": [{
    "Id": "Archive logs",
    "Status": "Enabled",
    "Filter": {"Prefix": "logs/"},
    "Transitions": [
      {"Days": 30, "StorageClass": "STANDARD_IA"},
      {"Days": 90, "StorageClass": "GLACIER"}
    ],
    "Expiration": {"Days": 365}
  }]
}
```

## S3 Security

### Bucket Policies
JSON-based access policy attached to bucket:

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "PublicReadGetObject",
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::my-bucket/*"
  }]
}
```

### Access Control Lists (ACLs)
- Legacy method (prefer bucket policies)
- Control access at bucket or object level

### Block Public Access
- **Account-level** or **bucket-level** settings
- Four settings to prevent public access
- Enabled by default (recommended)

### Encryption

**Server-Side Encryption (SSE)**:
- **SSE-S3**: AWS-managed keys
- **SSE-KMS**: AWS KMS keys (more control)
- **SSE-C**: Customer-provided keys

**Client-Side Encryption**:
- Encrypt before uploading
- Decrypt after downloading

### Pre-Signed URLs
Temporary URL for private object:

```bash
aws s3 presign s3://my-bucket/file.pdf --expires-in 3600
```

## S3 Static Website Hosting

Host static websites directly from S3.

### Requirements
- Bucket name = domain name (optional)
- Enable static website hosting
- Make objects public
- Upload HTML, CSS, JS files

### Configuration
1. **Properties** ‚Üí **Static website hosting**
2. Index document: `index.html`
3. Error document: `error.html`
4. Endpoint: `http://bucket-name.s3-website-region.amazonaws.com`

### Example Structure
```
my-website/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ error.html
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ style.css
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ script.js
‚îî‚îÄ‚îÄ images/
    ‚îî‚îÄ‚îÄ logo.png
```

## S3 Performance Optimization

### Multipart Upload
- **Required** for objects > 5 GB
- **Recommended** for objects > 100 MB
- Parallel uploads for better performance

### Transfer Acceleration
- Use CloudFront edge locations
- Up to 50-500% faster
- Format: `bucket.s3-accelerate.amazonaws.com`

### S3 Select
- Retrieve subset of data using SQL
- Save on data transfer costs
- Up to 400% faster

## S3 Replication

### Cross-Region Replication (CRR)
- Replicate across AWS regions
- Compliance, lower latency, DR

### Same-Region Replication (SRR)
- Within same region
- Log aggregation, backup

### Requirements
- Source and destination buckets must have versioning
- IAM role for S3 replication
- Can be different storage class

## S3 Event Notifications

Trigger actions when events occur:

### Events
- Object created
- Object removed
- Object restored
- Replication events

### Destinations
- SNS topic
- SQS queue
- Lambda function

### Example Use Case
Upload image ‚Üí S3 event ‚Üí Lambda ‚Üí Create thumbnail ‚Üí Store in S3

## ‚úÖ Hands-on Lab: S3 Basics

### Lab 1: Create Bucket and Upload Files

**Step 1: Create Bucket**
1. Go to **S3 Console** ‚Üí **Create bucket**
2. Bucket name: `my-first-bucket-[your-name]-[random]`
3. Region: Choose your region
4. Block Public Access: Keep all checked (for now)
5. Versioning: Enable
6. Click **Create bucket**

**Step 2: Upload Files**
1. Click bucket name
2. Click **Upload**
3. Add files or drag-and-drop
4. Click **Upload**

**Step 3: Organize with Folders**
1. Click **Create folder**
2. Name: `images`
3. Upload files to folder

**Step 4: View Object Details**
1. Click object name
2. View properties, permissions, versions
3. Copy Object URL

### Lab 2: Host Static Website

**Step 1: Prepare Files**
Create `index.html`:
```html
<!DOCTYPE html>
<html>
<head>
    <title>My S3 Website</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <h1>Welcome to My S3 Website!</h1>
    <p>This is hosted on Amazon S3</p>
    <img src="images/cloud.png" alt="Cloud">
</body>
</html>
```

Create `css/style.css`:
```css
body {
    font-family: Arial, sans-serif;
    max-width: 800px;
    margin: 50px auto;
    padding: 20px;
    background: #f0f0f0;
}
h1 { color: #FF9900; }
img { max-width: 100%; }
```

Create `error.html`:
```html
<!DOCTYPE html>
<html>
<head><title>Error</title></head>
<body>
    <h1>404 - Page Not Found</h1>
    <p>Sorry, the page you're looking for doesn't exist.</p>
</body>
</html>
```

**Step 2: Create and Configure Bucket**
1. Create bucket: `my-website-[random-number]`
2. **Uncheck** "Block all public access"
3. Acknowledge warning
4. Upload all files

**Step 3: Enable Static Website Hosting**
1. Bucket ‚Üí **Properties**
2. Scroll to **Static website hosting**
3. Click **Edit** ‚Üí **Enable**
4. Index document: `index.html`
5. Error document: `error.html`
6. **Save changes**
7. Note the endpoint URL

**Step 4: Make Objects Public**

Add bucket policy:
1. Bucket ‚Üí **Permissions** ‚Üí **Bucket policy**
2. Click **Edit**
3. Paste:
```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Sid": "PublicReadGetObject",
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::YOUR-BUCKET-NAME/*"
  }]
}
```
4. Replace `YOUR-BUCKET-NAME`
5. **Save changes**

**Step 5: Access Website**
- Open the endpoint URL in browser
- Should see your website!

### Lab 3: Configure Lifecycle Policy

1. Bucket ‚Üí **Management** ‚Üí **Create lifecycle rule**
2. Rule name: `Archive old logs`
3. Filter: Prefix = `logs/`
4. Transitions:
   - Move to Standard-IA after 30 days
   - Move to Glacier after 90 days
5. Expiration: Delete after 365 days
6. **Create rule**

### Lab 4: Enable Cross-Region Replication

1. Source bucket ‚Üí **Management** ‚Üí **Replication rules**
2. Create rule: `Backup to another region`
3. Status: Enabled
4. Destination: Create new bucket in different region
5. IAM role: Create new role
6. **Save**

## AWS CLI Commands for S3

```bash
# List buckets
aws s3 ls

# Create bucket
aws s3 mb s3://my-bucket

# Upload file
aws s3 cp myfile.txt s3://my-bucket/

# Download file
aws s3 cp s3://my-bucket/myfile.txt ./

# Sync directory
aws s3 sync ./localdir s3://my-bucket/folder/

# Delete object
aws s3 rm s3://my-bucket/myfile.txt

# Delete bucket (must be empty)
aws s3 rb s3://my-bucket

# Force delete bucket with contents
aws s3 rb s3://my-bucket --force
```

## Common S3 Interview Questions

1. **Q: How is S3 different from EBS?**
   - S3: Object storage, accessible over internet, durable
   - EBS: Block storage, attached to EC2, low latency

2. **Q: How to host a website on S3?**
   - Enable static hosting, make bucket/objects public, upload files

3. **Q: What is S3 consistency model?**
   - Strong read-after-write consistency for all operations

4. **Q: How to secure S3 bucket?**
   - Block public access, bucket policies, encryption, versioning, MFA delete

---

[‚Üê Previous: EC2](04-EC2.md) | [Back to Main Guide](README.md) | [Next: VPC ‚Üí](06-VPC.md)
